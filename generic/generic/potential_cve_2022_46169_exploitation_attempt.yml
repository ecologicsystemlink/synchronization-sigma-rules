- dataTypes:
  - generic
  name: Potential CVE-2022-46169 Exploitation Attempt
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Security Detection
  technique: T1190
  adversary: UNKNOWN
  description: Detects potential exploitation attempts that target the Cacti Command
    Injection CVE-2022-46169
  references:
  - https://github.com/0xf4n9x/CVE-2022-46169
  - https://github.com/Cacti/cacti/security/advisories/GHSA-6p93-p743-35gf
  - https://github.com/rapid7/metasploit-framework/pull/17407
  where: safe("log.csMethod", "") == "GET" && safe("log.csUriQuery", "").contains("/remote_agent.php")
    && safe("log.csUriQuery", "").contains("action=polldata") && safe("log.csUriQuery",
    "").contains("poller_id=") && (safe("log.csUriQuery", "").contains("| base64 -d
    | /bin/bash`") || safe("log.csUriQuery", "").contains("%7C%20base64%20-d%20%7C%20%2Fbin%2Fbash%60")
    || safe("log.csUriQuery", "").contains("`whoami") || safe("log.csUriQuery", "").contains("powershell")
    || safe("log.csUriQuery", "").contains("cmd") || safe("log.csUriQuery", "").contains("wget"))
