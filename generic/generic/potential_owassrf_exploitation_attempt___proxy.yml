- dataTypes:
  - generic
  name: Potential OWASSRF Exploitation Attempt - Proxy
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Security Detection
  technique: T1190
  adversary: UNKNOWN
  description: Detects exploitation attempt of the OWASSRF variant targeting exchange
    servers It uses the OWA endpoint to access the powershell backend endpoint
  references:
  - https://www.crowdstrike.com/blog/owassrf-exploit-analysis-and-recommendations/
  - https://www.rapid7.com/blog/post/2022/12/21/cve-2022-41080-cve-2022-41082-rapid7-observed-exploitation-of-owassrf-in-exchange-for-rce/
  where: safe("log.csMethod", "") == "POST" && safe("log.scStatus", "") == 200 &&
    safe("log.cUri", "").contains("/owa/") && safe("log.cUri", "").contains("/powershell")
    && (safe("log.cUri", "").contains("@") || safe("log.cUri", "").contains("%40"))
    && !(safe("log.cUseragent", "") == "ClientInfo" || safe("log.cUseragent", "")
    == "Microsoft WinRM Client" || safe("log.cUseragent", "") == "Exchange BackEnd
    Probes")
