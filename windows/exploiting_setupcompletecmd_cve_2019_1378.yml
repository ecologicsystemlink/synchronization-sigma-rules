- dataTypes:
  - wineventlog
  name: Exploiting SetupComplete.cmd CVE-2019-1378
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Execution
  technique: T1068, T1059.003, T1574
  adversary: UNKNOWN
  description: Detects exploitation attempt of privilege escalation vulnerability
    via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378
  references:
  - https://web.archive.org/web/20200530031708/https://www.embercybersecurity.com/blog/cve-2019-1378-exploiting-an-access-control-privilege-escalation-vulnerability-in-windows-10-update-assistant-wua
  where: safe("log.parentCommandLine", "").contains("\\cmd.exe") && safe("log.parentCommandLine",
    "").contains("/c") && safe("log.parentCommandLine", "").contains("C:\\Windows\\Setup\\Scripts\\")
    && (safe("log.parentCommandLine", "").endsWith("SetupComplete.cmd") || safe("log.parentCommandLine",
    "").endsWith("PartnerSetupComplete.cmd")) && !(safe("log.image", "").startsWith("C:\\Windows\\System32\\")
    || safe("log.image", "").startsWith("C:\\Windows\\SysWOW64\\") || safe("log.image",
    "").startsWith("C:\\Windows\\WinSxS\\") || safe("log.image", "").startsWith("C:\\Windows\\Setup\\"))
