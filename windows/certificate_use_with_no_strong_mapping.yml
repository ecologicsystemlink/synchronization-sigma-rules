- dataTypes:
  - wineventlog
  name: Certificate Use With No Strong Mapping
  impact:
    confidentiality: 2
    integrity: 2
    availability: 2
  category: General Security
  technique: Unknown
  adversary: UNKNOWN
  description: Detects a user certificate that was valid but could not be mapped to
    a user in a strong way (such as via explicit mapping, key trust mapping, or a
    SID) This could be a sign of exploitation of the elevation of privilege vulnerabilities
    (CVE-2022-34691, CVE-2022-26931, CVE-2022-26923) that can occur when the KDC allows
    certificate spoofing by not requiring a strong mapping. Events where the AccountName
    and CN of the Subject do not match, or where the CN ends in a dollar sign indicating
    a machine, may indicate certificate spoofing.
  references:
  - https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16
  where: (safe("log.providerName", "") == "Kerberos-Key-Distribution-Center" || safe("log.providerName",
    "") == "Microsoft-Windows-Kerberos-Key-Distribution-Center") && (safe("log.eventCode",
    0.0) == double(39) || safe("log.eventCode", 0.0) == double(41))
