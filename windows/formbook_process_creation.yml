- dataTypes:
  - wineventlog
  name: Formbook Process Creation
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Security Detection
  technique: T1587.001
  adversary: UNKNOWN
  description: Detects Formbook like process executions that inject code into a set
    of files in the System32 folder, which executes a special command command line
    to delete the dropper from the AppData Temp folder. We avoid false positives by
    excluding all parent process with command line parameters.
  references:
  - https://inquest.net/blog/2018/06/22/a-look-at-formbook-stealer
  - https://app.any.run/tasks/388d5802-aa48-4826-b069-250420504758/
  - https://app.any.run/tasks/8e22486b-5edc-4cef-821c-373e945f296c/
  - https://app.any.run/tasks/62bb01ae-25a4-4180-b278-8e464a90b8d7/
  where: (safe("log.parentCommandLine", "").startsWith("C:\\Windows\\System32\\")
    || safe("log.parentCommandLine", "").startsWith("C:\\Windows\\SysWOW64\\")) &&
    safe("log.parentCommandLine", "").endsWith(".exe") && (safe("log.commandLine",
    "").contains("/c") && safe("log.commandLine", "").contains("del") && safe("log.commandLine",
    "").contains("C:\\Users\\") && safe("log.commandLine", "").contains("\\AppData\\Local\\Temp\\")
    || safe("log.commandLine", "").contains("/c") && safe("log.commandLine", "").contains("del")
    && safe("log.commandLine", "").contains("C:\\Users\\") && safe("log.commandLine",
    "").contains("\\Desktop\\") || safe("log.commandLine", "").contains("/C") && safe("log.commandLine",
    "").contains("type nul >") && safe("log.commandLine", "").contains("C:\\Users\\")
    && safe("log.commandLine", "").contains("\\Desktop\\")) && safe("log.commandLine",
    "").endsWith(".exe")
