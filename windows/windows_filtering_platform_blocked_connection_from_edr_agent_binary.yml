- dataTypes:
  - wineventlog
  name: Windows Filtering Platform Blocked Connection From EDR Agent Binary
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Security Detection
  technique: T1562
  adversary: UNKNOWN
  description: Detects a Windows Filtering Platform (WFP) blocked connection event
    involving common Endpoint Detection and Response (EDR) agents. Adversaries may
    use WFP filters to prevent Endpoint Detection and Response (EDR) agents from reporting
    security events.
  references:
  - https://github.com/netero1010/EDRSilencer
  - https://github.com/amjcyber/EDRNoiseMaker
  - https://ghoulsec.medium.com/misc-series-4-forensics-on-edrsilencer-events-428b20b3f983
  where: safe("log.eventCode", 0.0) == double(5157) && (safe("log.application", "").endsWith("\\AmSvc.exe")
    || safe("log.application", "").endsWith("\\cb.exe") || safe("log.application",
    "").endsWith("\\CETASvc.exe") || safe("log.application", "").endsWith("\\CNTAoSMgr.exe")
    || safe("log.application", "").endsWith("\\CrAmTray.exe") || safe("log.application",
    "").endsWith("\\CrsSvc.exe") || safe("log.application", "").endsWith("\\CSFalconContainer.exe")
    || safe("log.application", "").endsWith("\\CSFalconService.exe") || safe("log.application",
    "").endsWith("\\CybereasonAV.exe") || safe("log.application", "").endsWith("\\CylanceSvc.exe")
    || safe("log.application", "").endsWith("\\cyserver.exe") || safe("log.application",
    "").endsWith("\\CyveraService.exe") || safe("log.application", "").endsWith("\\CyvrFsFlt.exe")
    || safe("log.application", "").endsWith("\\EIConnector.exe") || safe("log.application",
    "").endsWith("\\elastic-agent.exe") || safe("log.application", "").endsWith("\\elastic-endpoint.exe")
    || safe("log.application", "").endsWith("\\EndpointBasecamp.exe") || safe("log.application",
    "").endsWith("\\ExecutionPreventionSvc.exe") || safe("log.application", "").endsWith("\\filebeat.exe")
    || safe("log.application", "").endsWith("\\fortiedr.exe") || safe("log.application",
    "").endsWith("\\hmpalert.exe") || safe("log.application", "").endsWith("\\hurukai.exe")
    || safe("log.application", "").endsWith("\\LogProcessorService.exe") || safe("log.application",
    "").endsWith("\\mcsagent.exe") || safe("log.application", "").endsWith("\\mcsclient.exe")
    || safe("log.application", "").endsWith("\\MsMpEng.exe") || safe("log.application",
    "").endsWith("\\MsSense.exe") || safe("log.application", "").endsWith("\\Ntrtscan.exe")
    || safe("log.application", "").endsWith("\\PccNTMon.exe") || safe("log.application",
    "").endsWith("\\QualysAgent.exe") || safe("log.application", "").endsWith("\\RepMgr.exe")
    || safe("log.application", "").endsWith("\\RepUtils.exe") || safe("log.application",
    "").endsWith("\\RepUx.exe") || safe("log.application", "").endsWith("\\RepWAV.exe")
    || safe("log.application", "").endsWith("\\RepWSC.exe") || safe("log.application",
    "").endsWith("\\sedservice.exe") || safe("log.application", "").endsWith("\\SenseCncProxy.exe")
    || safe("log.application", "").endsWith("\\SenseIR.exe") || safe("log.application",
    "").endsWith("\\SenseNdr.exe") || safe("log.application", "").endsWith("\\SenseSampleUploader.exe")
    || safe("log.application", "").endsWith("\\SentinelAgent.exe") || safe("log.application",
    "").endsWith("\\SentinelAgentWorker.exe") || safe("log.application", "").endsWith("\\SentinelBrowserNativeHost.exe")
    || safe("log.application", "").endsWith("\\SentinelHelperService.exe") || safe("log.application",
    "").endsWith("\\SentinelServiceHost.exe") || safe("log.application", "").endsWith("\\SentinelStaticEngine.exe")
    || safe("log.application", "").endsWith("\\SentinelStaticEngineScanner.exe") ||
    safe("log.application", "").endsWith("\\sfc.exe") || safe("log.application", "").endsWith("\\sophos
    ui.exe") || safe("log.application", "").endsWith("\\sophosfilescanner.exe") ||
    safe("log.application", "").endsWith("\\sophosfs.exe") || safe("log.application",
    "").endsWith("\\sophoshealth.exe") || safe("log.application", "").endsWith("\\sophosips.exe")
    || safe("log.application", "").endsWith("\\sophosLivequeryservice.exe") || safe("log.application",
    "").endsWith("\\sophosnetfilter.exe") || safe("log.application", "").endsWith("\\sophosntpservice.exe")
    || safe("log.application", "").endsWith("\\sophososquery.exe") || safe("log.application",
    "").endsWith("\\sspservice.exe") || safe("log.application", "").endsWith("\\TaniumClient.exe")
    || safe("log.application", "").endsWith("\\TaniumCX.exe") || safe("log.application",
    "").endsWith("\\TaniumDetectEngine.exe") || safe("log.application", "").endsWith("\\TMBMSRV.exe")
    || safe("log.application", "").endsWith("\\TmCCSF.exe") || safe("log.application",
    "").endsWith("\\TmListen.exe") || safe("log.application", "").endsWith("\\TmWSCSvc.exe")
    || safe("log.application", "").endsWith("\\Traps.exe") || safe("log.application",
    "").endsWith("\\winlogbeat.exe") || safe("log.application", "").endsWith("\\WSCommunicator.exe")
    || safe("log.application", "").endsWith("\\xagt.exe"))
