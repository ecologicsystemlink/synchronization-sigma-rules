- dataTypes:
  - wineventlog
  name: Potential CVE-2022-29072 Exploitation Attempt
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Execution
  technique: Unknown
  adversary: UNKNOWN
  description: Detects potential exploitation attempts of CVE-2022-29072, a 7-Zip
    privilege escalation and command execution vulnerability. 7-Zip version 21.07
    and earlier on Windows allows privilege escalation (CVE-2022-29072) and command
    execution when a file with the .7z extension is dragged to the Help>Contents area.
    This is caused by misconfiguration of 7z.dll and a heap overflow. The command
    runs in a child process under the 7zFM.exe process.
  references:
  - https://github.com/kagancapar/CVE-2022-29072
  - https://twitter.com/kagancapar/status/1515219358234161153
  where: safe("log.parentImage", "").endsWith("\\7zFM.exe") && (safe("log.image",
    "").endsWith("\\cmd.exe") || safe("log.image", "").endsWith("\\powershell.exe")
    || safe("log.image", "").endsWith("\\pwsh.exe") || safe("log.originalFileName",
    "") == "Cmd.Exe" || safe("log.originalFileName", "") == "PowerShell.EXE" || safe("log.originalFileName",
    "") == "pwsh.dll") && !(safe("log.commandLine", "").contains(" /c ") || safe("log.commandLine",
    "").contains(" /k ") || safe("log.commandLine", "").contains(" /r ") || safe("log.commandLine",
    "").endsWith(".bat") || safe("log.commandLine", "").endsWith(".cmd") || safe("log.commandLine",
    "").endsWith(".ps1") || safe("log.commandLine", "") == safe("log.nil", ""))
