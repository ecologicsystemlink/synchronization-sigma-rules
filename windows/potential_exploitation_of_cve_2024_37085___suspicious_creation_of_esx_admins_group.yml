- dataTypes:
  - wineventlog
  name: Potential Exploitation of CVE-2024-37085 - Suspicious Creation Of ESX Admins
    Group
  impact:
    confidentiality: 3
    integrity: 3
    availability: 3
  category: Execution
  technique: Unknown
  adversary: UNKNOWN
  description: Detects execution of the "net.exe" command in order to add a group
    named "ESX Admins". This could indicates a potential exploitation attempt of CVE-2024-37085,
    which allows an attacker to elevate their privileges to full administrative access
    on an domain-joined ESXi hypervisor. VMware ESXi hypervisors joined to an Active
    Directory domain consider any member of a domain group named "ESX Admins" to have
    full administrative access by default.
  references:
  - https://www.microsoft.com/en-us/security/blog/2024/07/29/ransomware-operators-exploit-esxi-hypervisor-vulnerability-for-mass-encryption/
  where: (safe("log.image", "").endsWith("\\net.exe") || safe("log.image", "").endsWith("\\net1.exe")
    || safe("log.originalFileName", "") == "net.exe" || safe("log.originalFileName",
    "") == "net1.exe") && safe("log.commandLine", "").contains("/add") && safe("log.commandLine",
    "").contains("/domain") && safe("log.commandLine", "").contains("ESX Admins")
    && safe("log.commandLine", "").contains("group") || (safe("log.image", "").endsWith("\\PowerShell.exe")
    || safe("log.image", "").endsWith("\\pwsh.exe") || safe("log.originalFileName",
    "") == "PowerShell.exe" || safe("log.originalFileName", "") == "pwsh.dll") &&
    safe("log.commandLine", "").contains("New-ADGroup") && safe("log.commandLine",
    "").contains("ESX Admins")
